ğŸ”´ **parameter ê°’ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ìœ ì˜, SQL Join ê³µë¶€**

<br>

# Database Connection Class
## Util.java

Database ì—°ê²°ì„ ìœ„í•œ í´ë˜ìŠ¤ ì‘ì„±

```java
package DBPKG;

import java.sql.Connection;
import java.sql.DriverManager;

public class Util {
	public static Connection getConnection() throws Exception{
		Class.forName("oracle.jdbc.OracleDriver");
		Connection con=DriverManager.getConnection("jdbc:oracle:thin:@//localhost:1521/xe","system","1234");
		return con;
	}
}
```

# SQL

ì‹œí—˜ì¥ì—ì„  Oracleì„ ì‚¬ìš©í•œë‹¤. <br>
sql developerê°€ ì—†ì„ ê²½ìš°, cmd - sqlplus system/1234ë¡œ ì ‘ì†í•œë‹¤.

```sql
create table member_tbl_02 (
    custno number(6) not null,
    custname varchar2(20),
    phone varchar2(13),
    address varchar2(60),
    joindate date,
    grade char(1),
    city char(2),
    primary key(custno)
);

desc member_tbl_02;

create table money_tbl_02 (
custno number(6) not null,
salenol number(8) not null,
pcost number(8),
amount number(4),
price number(8),
pcode varchar2(4),
sdate date,
primary key(custno, salenol)
);

desc money_tbl_02;

insert into member_tbl_02 values(100001, 'ê¹€í–‰ë³µ', '010-1111-2222', 'ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ íœ˜ê²½1ë™', '20151202', 'A', 01);
insert into member_tbl_02 values(100002, 'ì´ì¶•ë³µ', '010-1111-3333', 'ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ íœ˜ê²½2ë™', '20151206', 'B', 01);
insert into member_tbl_02 values(100003, 'ì¥ë¯¿ìŒ', '010-1111-4444', 'ìš¸ë¦‰êµ° ìš¸ë¦‰ì ë…ë„1ë¦¬', '20151001', 'B', 30);
insert into member_tbl_02 values(100004, 'ìµœì‚¬ë‘', '010-1111-5555', 'ìš¸ë¦‰êµ° ìš¸ë¦‰ì ë…ë„2ë¦¬', '20151113', 'A', 30);
insert into member_tbl_02 values(100005, 'ì§„í‰í™”', '010-1111-6666', 'ì œì£¼ë„ ì œì£¼ì‹œ ì™¸ë‚˜ë¬´ê³¨', '20151225', 'B', 60);
insert into member_tbl_02 values(100006, 'ì°¨ê³µë‹¨', '010-1111-7777', 'ì œì£¼ë„ ì œì£¼ì‹œ ê°ë‚˜ë¬´ê³¨', '20151211', 'C', 60);

select * from member_tbl_02;

insert into money_tbl_02 values(100001,20160001,500,5,2500,'A001','20160101');
insert into money_tbl_02 values(100001,20160002,1000,5,4000,'A002','20160101');
insert into money_tbl_02 values(100001,20160003,500,5,1500,'A008','20160101');
insert into money_tbl_02 values(100002,20160004,2000,5,2000,'A004','20160102');
insert into money_tbl_02 values(100002,20160005,500,5,500,'A001','20160103');
insert into money_tbl_02 values(100003,20160006,1500,5,3000,'A003','20160103');
insert into money_tbl_02 values(100004,20160007,500,5,1000,'A001','20160104');
insert into money_tbl_02 values(100004,20160008,300,5,300,'A005','20160104');
insert into money_tbl_02 values(100004,20160009,600,5,600,'A006','20160104');
insert into money_tbl_02 values(100004,20160010,3000,5,3000,'A007','20160106');

select * from money_tbl_02;

select max(custno)+1 custno -- max(custno)+1 ì´ë¦„ì„ custnoìœ¼ë¡œ ëŒ€ì²´í•œë‹¤.
from member_tbl_02;

select me.custno, me.custname, me.grade, sum(mo.price)
from member_tbl_02 me, money_tbl_02 mo
where me.custno=mo.custno
group by me.custno, me.custname, me.grade
order by sum(price) desc;

delete member_tbl_02;

commit;
```

# jsp:include page
## header.jsp
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>header</title>
<style type="text/css">
a{
text-decoration: none;
color: black;
}
</style>
</head>
<body>
<header style="position: fixed; top: 0px; width: 100%; height: 40px; background-color: blue; color: white; font-size: 20px; text-align: center; line-height: 40px; font-weight: bold;">ì‡¼í•‘ëª° íšŒì›ê´€ë¦¬ ver 1.0</header>
<nav style="position: fixed; top: 40px; width: 100%; height:30px; line-height: 30px; background-color: lightblue; padding-left: 20px; text-align: center;">
<a href="join.jsp">íšŒì›ë“±ë¡</a> &nbsp; <a href="list.jsp">íšŒì›ëª©ë¡ì¡°íšŒ/ìˆ˜ì •</a> &nbsp; <a href="salary.jsp">íšŒì›ë§¤ì¶œì¡°íšŒ</a> &nbsp; <a href="index.jsp">í™ˆìœ¼ë¡œ</a> </nav>
</body>
</html>
```
## footer.jsp
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>footer</title>
</head>
<body>
<footer style="position: fixed; bottom: 0px; width: 100%; height: 30px; background-color: black; color: white; text-align: center; line-height: 30px; font-size: 10px">
HRDKOREA Copyright â“2016 All rights reserved. human Resources Development Service of Korea.
</footer>
</body>
</html>
```

# Javascript
## check.js
```javascript
function joinCheck() {
	if(document.frm.custname.value.length==0) { // form name: frm
		alert("íšŒì› ì„±ëª…ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
		frm.custname.focus();
		return false;
	}
	
	if(document.frm.phone.value.length==0) {
		alert("íšŒì› ì „í™”ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
		frm.custname.focus();
		return false;
	}

	if(document.frm.address.value.length==0) {
		alert("íšŒì› ì£¼ì†Œê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
		frm.address.focus();
		return false;
	}

	if(document.frm.joindate.value.length==0) {
		alert("ê°€ì… ì¼ìê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
		frm.joindate.focus();
		return false;
	}

	if(document.frm.grade.value.length==0) {
		alert("ê³ ê° ë“±ê¸‰ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
		frm.grade.focus();
		return false;
	}

	if(document.frm.city.value.length==0) {
		alert("ë„ì‹œ ì½”ë“œê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
		frm.city.focus();
		return false;
	}
	
	success();
	return true;
}

function success() {
	alert("íšŒì› ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
}

function search() {
	window.location='list.jsp';
}

function modify() {
	alert("íšŒì› ì •ë³´ ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
}
```

# JSP
## index.jsp
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>index</title>
</head>
<body>

<jsp:include page="header.jsp" />

<section style="position: fixed; top: 70px; width: 100%; height: 100%; background-color: lightgray">
<h2 style="text-align: center"><b>ì‡¼í•‘ëª° íšŒì›ê´€ë¦¬ í”„ë¡œê·¸ë¨</b></h2>
<p style="padding-left: 10px">
ì‡¼í•‘ëª° íšŒì›ì •ë³´ì™€ íšŒì›ë§¤ì¶œ ì •ë³´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ êµ¬ì¶•í•˜ê³  íšŒì›ê´€ë¦¬ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•˜ëŠ” í”„ë¡œê·¸ë¨ì´ë‹¤. <br>
í”„ë¡œê·¸ë¨ ì‘ì„± ìˆœì„œ <br>
1. íšŒì›ì •ë³´ í…Œì´ë¸”ì„ ì‘ì„±í•œë‹¤. <br>
2. ë§¤ì¶œì •ë³´ í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤. <br>
3. íšŒì›ì •ë³´, ë§¤ì¶œì •ë³´ í…Œì´ë¸”ì— ì œì‹œëœ ë¬¸ì œì§€ì˜ ì°¸ì¡° ë°ì´í„°ë¥¼ ì¶”ê°€ ìƒì„±í•œë‹¤. <br>
4. íšŒì›ì •ë³´ ì…ë ¥ í™”ë©´ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•œë‹¤. <br>
5. íšŒì›ì •ë³´ ì¡°íšŒ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•œë‹¤. <br>
6. íšŒì›ë§¤ì¶œì •ë³´ ì¡°íšŒ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•œë‹¤. <br>
</p>
</section>

<jsp:include page="footer.jsp" />

</body>
</html>
```
## join.jsp
```jsp
<%@page import="java.sql.ResultSet"%>
<%@page import="DBPKG.Util"%>
<%@page import="java.sql.Statement"%>
<%@page import="java.sql.Connection"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>join</title>
</head>
<body>

<script type="text/javascript" src="check.js"></script>
<jsp:include page="header.jsp"></jsp:include>

<section style="position: fixed; top: 70px; width: 100%; height: 100%; background-color: lightgray">
<h2 style="text-align: center"><b>ì‡¼í•‘ëª° íšŒì› ë“±ë¡</b></h2>

<form method="post" action="action.jsp" name="frm" style="display: flex; align-items: center; justify-content: center; text-align: center">

<input type="hidden" name="mode" value="insert">

<table border="1">

<%
request.setCharacterEncoding("UTF-8");
Connection con=null;
Statement stmt=null;
String custno="";

try{
	con=Util.getConnection(); // DB ì—°ê²°!(Util í´ë˜ìŠ¤ì—ì„œ ë§Œë“  DB ì ‘ì† í´ë˜ìŠ¤ í˜¸ì¶œ)
	stmt=con.createStatement(); // SQL ì‹¤í–‰ì„ ìœ„í•œ ë³€ìˆ˜ë¥¼ ìƒì„±í•œë‹¤.
	String sql="select max(custno)+1 custno from member_tbl_02";
	ResultSet rs=stmt.executeQuery(sql); // stmtë¥¼ í†µí•´ì„œ sql ì‹¤í–‰ ê²°ê³¼ë¥¼ ë‹´ëŠ”ë‹¤.
	rs.next(); // 1ê°œì˜ ê²°ê³¼ë¬¼ì„ ì¶œë ¥í•œë‹¤.
	custno=rs.getString("custno");
}catch(Exception e){
	e.printStackTrace();
}
%>

<tr>
<td>íšŒì› ë²ˆí˜¸(ìë™ ë°œìƒ)</td>
<td><input type="text" name="custno" value="<%=custno %>" readonly="readonly"></td>
</tr>

<tr>
<td>íšŒì› ì„±ëª…</td>
<td><input type="text" name="custname"></td>
</tr>

<tr>
<td>íšŒì› ì „í™”</td>
<td><input type="text" name="phone"></td>
</tr>

<tr>
<td>íšŒì› ì£¼ì†Œ</td>
<td><input type="text" name="address"></td>
</tr>

<tr>
<td>ê°€ì…ì¼ì</td>
<td><input type="text" name="joinDate"></td>
</tr>

<tr>
<td>ê³ ê° ë“±ê¸‰[A:VIP, B: ì¼ë°˜, C: ì§ì›]</td>
<td><input type="text" name="grade"></td>
</tr>

<tr>
<td>ë„ì‹œ ì½”ë“œ</td>
<td><input type="text" name="city"></td>
</tr>

<tr>
<td colspan="2"> <!-- colspan: ì—´ ë³‘í•© -->
<input type="submit" value="ë“±ë¡" onclick="return joinCheck()">
<input type="button" value="ì¡°íšŒ" onclick="return search()"> <!-- submit: ì œì¶œ -->
</tr>

</table>
</form>
</section>

<jsp:include page="footer.jsp"></jsp:include>

</body>
</html>
```

## list.jsp
```jsp
<%@page import="java.sql.ResultSet"%>
<%@page import="DBPKG.Util"%>
<%@page import="java.sql.Statement"%>
<%@page import="java.sql.Connection"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>list</title>
</head>
<body>

<jsp:include page="header.jsp" />

<section style="position: fixed; top: 70px; width: 100%; height: 100%; background-color: lightgray">
<h2 style="text-align: center"><b>íšŒì› ëª©ë¡ ì¡°íšŒ/ìˆ˜ì •</b></h2>
<form name="frm" style="display: flex; align-items: center; justify-content: center; text-align: center">
<table border="1">
<tr>
<td>íšŒì› ë²ˆí˜¸</td>
<td>íšŒì› ì„±ëª…</td>
<td>ì „í™”ë²ˆí˜¸</td>
<td>ì£¼ì†Œ</td>
<td>ê°€ì…ì¼ì</td>
<td>ê³ ê°ë“±ê¸‰</td>
<td>ê±°ì£¼ì§€ì—­</td>
</tr>

<%
request.setCharacterEncoding("UTF-8");
Connection con=null;
Statement stmt=null;
String grade="";

try{
	con=Util.getConnection();
	stmt=con.createStatement();
	String sql="select * from member_tbl_02 order by custno";
	ResultSet rs=stmt.executeQuery(sql);
	while(rs.next()){
		grade=rs.getString("grade");
		switch(grade){
		case "A" :
			grade="VIP";
			break;
		case "B" :
			grade="ì¼ë°˜";
			break;
		case "C" :
			grade="ì§ì›";
			break;
		}
%>

<tr>
<td> <a href="modify.jsp?mod_custno=<%=rs.getString("custno") %>"><%=rs.getString("custno") %></a></td>
<td><%=rs.getString("custname") %></td>
<td><%=rs.getString("phone") %></td>
<td><%=rs.getString("address") %></td>
<td><%=rs.getDate("joindate") %></td>
<td><%=grade %></td>
<td><%=rs.getString("city") %></td>
</tr>
<%
	}
}catch(Exception e){
	e.printStackTrace();
}
%>
</table>
</form>
</section>

<jsp:include page="footer.jsp" />

</body>
</html>
```

## salary.jsp
```jsp
<%@page import="java.security.interfaces.RSAKey"%>
<%@page import="DBPKG.Util"%>
<%@page import="java.sql.Connection"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.Statement"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>salary</title>
</head>
<body>

<jsp:include page="header.jsp" />

<section style="position: fixed; top: 70px; width: 100%; height: 100%; background-color: lightgray">
<h2 style="text-align: center"><b>íšŒì› ë§¤ì¶œ ì¡°íšŒ</b></h2>
<form name="frm" style="display: flex; align-items: center; justify-content: center; text-align: center">
<table border="1">

<tr>
<td>íšŒì› ë²ˆí˜¸</td>
<td>íšŒì› ì„±ëª…</td>
<td>ê³ ê° ë“±ê¸‰</td>
<td>ë§¤ì¶œ</td>
</tr>

<%
request.setCharacterEncoding("UTF-8");
Connection con=null;
Statement stmt=null;
String grade="";

try{
	con=Util.getConnection();
	stmt=con.createStatement();
	// group byì—ëŠ” í•¨ìˆ˜ X | select, havingì—ë§Œ ì‚¬ìš© ê°€ëŠ¥
	String sql="select me.custno, me.custname, me.grade, sum(mo.price) price "
			  +"from member_tbl_02 me, money_tbl_02 mo "
			  +"where me.custno=mo.custno "
			  +"group by me.custno, me.custname, me.grade "
			  +"order by sum(mo.price) desc";
	ResultSet rs=stmt.executeQuery(sql);
	while(rs.next()) {
		grade=rs.getString("grade");
		switch(grade){
		case "A" :
			grade="VIP";
			break;
		case "B" :
			grade="ì¼ë°˜";
			break;
		case "C" :
			grade="ì§ì›";
			break;
		}
%>

<tr>
<td><%=rs.getString("custno") %></td>
<td><%=rs.getString("custname") %></td>
<td><%=grade %></td>
<td><%=rs.getString("price") %></td>
</tr>

<%
	}
}catch(Exception e){
	e.printStackTrace();
}
%>

</table>
</form>
</section>

<jsp:include page="footer.jsp" />

</body>
</html>
```

## modify.jsp
```jsp
<%@page import="java.text.SimpleDateFormat"%>
<%@page import="org.apache.tomcat.websocket.Transformation"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="DBPKG.Util"%>
<%@page import="java.sql.Date"%>
<%@page import="java.sql.Statement"%>
<%@page import="java.sql.Connection"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>modify</title>
</head>
<body>
<script type="text/javascript" src="check.js"></script>
<jsp:include page="header.jsp"></jsp:include>

<%
request.setCharacterEncoding("UTF-8");
Connection con=null;
Statement stmt=null;
String mod_custno=request.getParameter("mod_custno");
String custname="";
String phone="";
String address="";
Date joinDate;
String grade="";
String city="";
String joinDateStr="";


try{
	con=Util.getConnection();
	stmt=con.createStatement();
	String sql="select * from member_tbl_02 where custno= "+mod_custno;
	ResultSet rs=stmt.executeQuery(sql);
	rs.next();
	mod_custno=rs.getString("custno");
	custname=rs.getString("custname");
	phone=rs.getString("phone");
	address=rs.getString("address");
	joinDate=rs.getDate("joinDate");
	grade=rs.getString("grade");
	city=rs.getString("city");
	
	SimpleDateFormat transFormat=new SimpleDateFormat("yyyy-MM-dd");
	joinDateStr=transFormat.format(joinDate);
}catch(Exception e){
	e.printStackTrace();
}
%>

<section style="position: fixed; top: 70px; width: 100%; height: 100%; background-color: lightgray">
<h2 style="text-align: center"><b>ì‡¼í•‘ëª° íšŒì› ì •ë³´ ìˆ˜ì •</b></h2>
<form method="post" action="action.jsp" name="frm" style="display: flex; align-items: center; justify-content: center; text-align: center">

<input type="hidden" name="mode" value="modify">

<table border="1">
<tr>
<td>íšŒì› ë²ˆí˜¸</td>
<td><input type="text" name="custno" value="<%=mod_custno %>" readonly="readonly"> </td>
</tr>
<tr>
<td>íšŒì› ì„±ëª…</td>
<td><input type="text" name="custname" value="<%=custname %>"> </td>
</tr>
<tr>
<td>íšŒì› ì „í™”</td>
<td><input type="text" name="phone" value="<%=phone %>"> </td>
</tr>
<tr>
<td>íšŒì› ì£¼ì†Œ</td>
<td><input type="text" name="address" value="<%=address %>"> </td>
</tr>
<tr>
<td>ê°€ì…ì¼ì</td>
<td><input type="text" name="joinDate" value="<%=joinDateStr %> "> </td>
</tr>
<tr>
<td>ê³ ê° ë“±ê¸‰[A: VIP, B: ì¼ë°˜, C: ì§ì›]</td>
<td><input type="text" name="grade" value="<%=grade %>"> </td>
</tr>
<tr>
<td>ë„ì‹œ ì½”ë“œ</td>
<td><input type="text" name="city" value="<%=city %>"> </td>
</tr>
<tr>
<td colspan="2">
<input type="submit" value="ìˆ˜ì •" onclick="return modify()">
<input type="button" value="ì¡°íšŒ" onclick="return search()">
</td>
</tr>
</table>
</form>
</section>
<jsp:include page="footer.jsp"></jsp:include>
</body>
</html>
```

## action.jsp
```jsp
<%@page import="DBPKG.Util"%>
<%@page import="java.sql.Statement"%>
<%@page import="java.sql.Connection"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>action</title>
</head>
<body>
<%
request.setCharacterEncoding("UTF-8");
Connection con=null;
Statement stmt=null;
String mode=request.getParameter("mode");

String custno=request.getParameter("custno");
String custname=request.getParameter("custname");
String phone=request.getParameter("phone");
String address=request.getParameter("address");
String joinDate=request.getParameter("joinDate");
String grade=request.getParameter("grade");
String city=request.getParameter("city");

try{
	con=Util.getConnection();
	stmt=con.createStatement();
	String sql="";
	
	switch(mode) {
	case "insert" :
		//   insert into member_tbl_02 values(1, 'í™ê¸¸ë™', ' 010-1111-2222', 'ëŒ€êµ¬', '2023-02-15', 'A', '03');
		sql="insert into member_tbl_02 values(" + custno +"," +
											"'" + custname + "'," +
											"'" + phone + "'," +
											"'" + address + "'," +
								  // to_date('joindate', 'yyyy-MM-dd')
								    "to_date('" + joinDate + "','yyyy-MM-dd')," +
											"'" + grade + "'," +
											"'" +city + "')";
		stmt.executeUpdate(sql);
%>

<jsp:forward page="join.jsp"></jsp:forward>

<%
	break;

	case "modify" :
		sql="update member_tbl_02 set " +
			"custname= '" + custname + "', " +
			"phone= '" + phone + "', " +
			"address= '" + address + "', " +
			"joindate= to_date('" + joinDate + "','yyyy-MM-dd'), " +
			"grade= '" + grade + "', " +
			"city= '" + city + "' " +
			"where custno= " + custno;
			;
		stmt.executeUpdate(sql);
%>

<jsp:forward page="modify.jsp"></jsp:forward>

<%
		break;
	}
}catch(Exception e){
	e.printStackTrace();
}
%>
</body>
</html>
```
